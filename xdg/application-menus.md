Видел в кедах менюшку-аналог виндового _Пуск_? А раскрывающиеся списки Категорий с приложениями? Вот этот список - и есть _application-menu_. Еще его можно встретить в диалоговых окнах выбора программы.

Крупные DE уже имеют готовые менюшки и располагают инструментами для управления ими. Так, например, в KDE за это отвечает улитита `kmenuedit` (ставится из одноименного пакета).

Ситуация меняется, когда мы начинаем работать с WM-ками. Где-то могут присутствовать просто готовые менюшки (редактируемые вручную), где-то вообще этого не будет.

Вариантов как править несколько:
1. наболее простой - поставить что-то из gnome/kde/xfce (тот же _kmenuedit_) и забыть о проблеме.
2. составить вручную или при помощи скрипта-генератора.

С первым вариантом все понятно, так что посмотрим на второй. 

### Как система понимает с какую менюху показать и где её искать:
Но прежде чем клипать свое меню, давайте хотя бы поверхностно разберемся как это работает.

1. Для сессии выставляется енва `XDG_MENU_PREFIX`, соответствующая началу имени файла с менюшкой. Чаще всего значением префикса является используемой DE (но в случае изврата, как у меня, можем именовать как вздумается). Важно понимать, что в переменной лежит лишь префикс, к которому подставляется имя файла по-умолчанию: `applications.menu`. Так что конвенция по именованию все-же есть. Таким образом у нас может быть несколько системыных меню, например, если используется несколько DE.
2. Когда возникает необходимость показать менюшку - программа ищет и читает нужный _menu_ файл среди доступных. Тутже стоит упомянуть, что если мы говорим о приложении из экосистемы (приснопамятные KDE Apps) - непосредственное обращение к файлу скорее всего будет совершать не сама программа, которой нужно меню (прим.: _dolphin_), а отдельный спец-модуль этой экосистемы (_kbuildsycoca6_)[^2]. Сам процесс обращения я расписывать не буду, это есть в [документации](https://specifications.freedesktop.org/menu-spec/latest/).


### Ручное конфигурирование менюшек.

Для арча есть отличный пакет, который можно поставить, сгенерить менюшку и сразу снести за ненадобностью.

```bash
pacman -S archlinux-xdg-menu
```

Там и готовая менюха (в целом, ее и без редактирования хватит что бы тот же _dolphin_ заработал) и `xdg-menu*` утилиты для ее редактирования.

Для всех остальных дистрибутивов можно поискать скрипты на подобии [menumaker](https://menumaker.sourceforge.net/) или обойтись силами голых `xdg-menu` утилит.

#### Директории и файлы

**Диры**

- `~/.config/menus` - менюшки пользака
- `/etc/xdg/menus` - глобальные менюшки
- `/usr/share/desktop-directories` - директории (категории) различных менюшек

**Файлы**

- `*.menu` 
- `*.directory`
- `/etc/update-menus.conf` - в случае пакета для арча, позволяет сгедерить для определенного WM из поддерживаемых.


[^1]: Arch Wiki: [xdg-menu](https://wiki.archlinux.org/title/Xdg-menu)
[^2]: Технически - это не совсем так. Упомянутый _kbuildsycoca*_ лишь определенным образом кеширует служебные файлы (_.desktop_, _.directory_, etc...) и следит что бы с ними все было в порядке. Таким образом достигается гарантия что все приложения экосистемы будут получать правильные данные. Но с точки зрения общей архитектуры и логики - считаю такую формулировку допустимой.
